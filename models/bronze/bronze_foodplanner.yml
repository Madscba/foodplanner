version: 2
sources:
  - name: foodplanner_source
    description: source foodplanner data
    database: BRONZE
    schema: FOODPLANNER_RAW 
    tables:
      - name: dietary_preferences
        description: a list of dietary preferences tracking table
        
        columns:
          - name: preference_id
            description: Foreign Key to USERS_PREFERENCES table
            tests:
              - unique
              - not_null
              - relationships:
                  to: source('foodplanner_source', 'users_to_preferences')
                  field: preference_id

      - name: users_to_preferences
        description: a mapping between users and dietary preferences
        
        columns:
          - name: preference_id
            description: Foreign Key to USERS_PREFERENCES table
            tests:
              - relationships:
                  to: source('foodplanner_source', 'dietary_preferences')
                  field: preference_id
          - name: customer_id
            description: Foreign Key to USERS_PREFERENCES table
            tests:
              - relationships:
                  to: source('tpch', 'users')
                  field: customer_id
      - name: users
        description: a list of users
        
        columns:
          - name: customer_id
            description: Foreign Key to USERS_PREFERENCES table
            tests:
              - unique
              - not_null
              - relationships:
                  to: source('foodplanner_source', 'users_to_preferences')
                  field: customer_id